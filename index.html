
<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
     <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>MLB Data Viz challenge</title>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js" charset="utf-8"></script>

    <style>
      .container{
        position:relative;
        float:left;
      }
      .playerList{
        width:300px;
        height:150px;
      }
      .playerBtn{
        display:inline-block;
        float:left;
        height:50px;
        width:50px;
        margin:5px;
        background-color:rgba(200,0,200,0.1);
        cursor:pointer;
      }
      .clicked{
        background-color:rgba(255,255,0,0.1);
      }
      .reset{
        display:inline-block;
        width:auto;
        cursor:pointer;
      }
    </style>

  </head>

  <body>
  <div id='hitting' class='container'>
  	<select id='clicker'>
  		<option value='HR'>Homers</option>
  		<option value='hits'>Hits</option>
  		<option value='RBI'>Ribbys</option>
  		<option value='BA'>Batting Average</option>
  		<option value='slug'>Slugging</option>
  		<option value='runs'>Runs</option>
  	</select>
    <br>
    <label><input type="radio" value="time" name="optradio1" checked>Over Time</label>
    <label><input type="radio" value="career" name="optradio1">Over Career</label>
    <br>
    <label><input type="radio" value="seasonal" name="optradio2" checked>Single-Season</label>
    <label><input type="radio" value="cumulative" name="optradio2">Cumulatively</label>

    <div class='playerList hitters'></div>
  </div>

  <div id='pitching' class='container'>
    <select id='clicker'>
      <option value='wins'>Wins</option>
      <option value='losses'>Losses</option>
      <option value='K'>Strikeouts</option>
      <option value='ERA'>ERA</option>
      <option value='ER'>Earned Runs</option>
      <option value='WHIP'>WHIP</option>
    </select>
    <br>
    <label><input type="radio" value="time" name="optradio1" checked>Over Time</label>
    <label><input type="radio" value="career" name="optradio1">Over Career</label>
    <br>
    <label><input type="radio" value="seasonal" name="optradio2" checked>Single-Season</label>
    <label><input type="radio" value="cumulative" name="optradio2">Cumulatively</label>

    <div class='playerList pitchers'></div>
  </div>

  <script>
    //shits getting mixed up for some reason//player name needs to be a part of csv and not separate list
    //could refactor so that there's one graph, generated by input of what you want to see (i.e. 'pitchers' or 'hitters')
    $(document).on('ready',function(){

  	var width = 700, height = 500, margins = {left:50,right:50,top:20,bottom:20};
    var hitDiv = d3.select('#hitting');
    var pitchDiv = d3.select('#pitching');
  	var hitSvg = hitDiv.append('svg').attr('height',height).attr('width',width);
    var pitchSvg = pitchDiv.append('svg').attr('height',height).attr('width',width);

  	var hitters = ['Barry_Bonds','Albert_Pujols','Babe_Ruth','Honus_Wagner','Joe_DiMaggio','Lou_Gehrig','Mickey_Mantle','Ty_Cobb','Willie_Mays','Ted_Williams'];
    var pitchers = ['Bob_Gibson','Christy_Mathewson','Cy_Young','Don_Drysdale','Eddie_Plank','Lefty_Grove','Pete_Alexander','Roger_Clemens','Tom_Seaver','Walter_Johnson'];

  	var hitData = [];
    var pitchData = [];

    hitters.forEach(function(guy){
      var player = hitSvg.append('g').attr('class','player '+guy);
      d3.csv('hitters/'+guy+'.csv')
        .row(function(d) { 
          return {
            year:+d.Year,
            hits:+d.H,
            doubles:+d['2B'],
            triples:+d['3B'],
            RBI:+d.RBI,
            HR:+d.HR,
            runs:+d.R,
            TB:+d.TB,
            AB:+d.AB,
            slug:+d.SLG,
            BA:+d.BA,
            BB:+d.BB,
            IBB:+d.IBB,
            SB:+d.SB,
            CS:+d.CS,
            K:+d.SO,
            G:+d.G
          }
        })
        .get(function(error, rows) { 
          var cumulative = JSON.parse(JSON.stringify(rows));
          var playerData = {seasonal:rows,cumulative:cumulative};
          hitData.push(playerData);
          if (hitData.length === hitters.length){
            makeHitters();
          }
        })
    });

    pitchers.forEach(function(guy){
      var player = pitchSvg.append('g').attr('class','player '+guy);
      d3.csv('pitchers/'+guy+'.csv')
        .row(function(d) { 
          return {
            year:+d.Year,
            wins:+d.W,
            losses:+d.L,
            ERA:+d.ERA,
            hits:+d.H,
            IP:+d.IP,
            ER:+d.ER,
            HR:+d.HR,
            K:+d.SO,
            WHIP:+d.WHIP,
            H9:+d.H9,
            BB:+d.BB,
            IBB:+d.IBB,
            HR9:+d.HR9,
            BB9:+d.BB9,
            K9:+d.SO9,
            KpW:+d['SO/W']
          }
        })
        .get(function(error, rows) { 
          var cumulative = JSON.parse(JSON.stringify(rows));
          var playerData = {seasonal:rows,cumulative:cumulative};
          pitchData.push(playerData);
          if (pitchData.length === pitchers.length){
            makePitchers();
          }
        })
    });

  	function makeHitters(){
  		//bind data to player
      hitters.forEach(function(guy,i){
        hitData[i].player = guy;
        var name = guy.split('_').join(" ");
        hitData[i].display = name;
        hitDiv.select('.playerList').append('div')
          .attr('class','playerBtn').text(name).attr('player',guy);

        var cumulative = hitData[i].cumulative;
        var hits=0,doubles=0,triples=0,RBI=0,HR=0,R=0;
        for (var b=0;b<cumulative.length;b++){
          var thisData = cumulative[b];
          hits += thisData.hits;
          doubles += thisData.doubles;
          triples += thisData.triples;
          RBI += thisData.RBI;
          HR += thisData.HR;
          R += thisData.runs;
          thisData.hits = hits;
          thisData.doubles = doubles;
          thisData.triples = triples;
          thisData.RBI = RBI;
          thisData.HR = HR;
          thisData.runs = R;
        }
      });

      hitDiv.select('.playerList').append('span').text('Reset').attr('class','reset');

    	var x = d3.scale.linear().range([margins.left,width-margins.right]);
  		var y = d3.scale.linear().range([(height-margins.bottom),margins.top]);

  		var lines = hitSvg.selectAll('.player').data(hitData).append('path')
  			.style('fill','none').style('stroke-width',3).style('stroke-opacity',0.5)
        .style('stroke','green');

  		var xAxis = d3.svg.axis().orient('bottom').tickFormat(d3.format('d'));
  		hitSvg.append('svg:g')
  			.attr('transform','translate('+0+','+(height-margins.bottom)+')')
  			.attr('class','xaxis')

  		var yAxis = d3.svg.axis().orient('left');
  		hitSvg.append('svg:g')
  			.attr('transform','translate('+margins.left+','+0+')')
  			.attr('class','yaxis')

	  	var lineFx = d3.svg.line()
	        .interpolate('step-after');

  		function lineChange(field,set){
	  		var fieldMax = d3.max(hitData, function(d) {
	  			return d3.max(d[set], function(e){
	  				return e[field];
	  			});
	  		});
	  		y.domain([0,fieldMax]);
	      lineFx.defined(function(d) { return d[field] >= 0; }).y(function (d) { return y(d[field]) });
	  		lines.transition().duration(500).attr('d', function(d){return lineFx(d[set])});
	  		hitDiv.select('.yaxis').transition().duration(500).call(yAxis.scale(y));
  		}

  		function timeChange(time){
  			if (time == 'career'){
  				var min = 1;
  				var max = d3.max(hitData, function(d){return d.seasonal.length});
  				lineFx.x(function(d,i){return x(i+1)});
  			}else{
  			  var min = d3.min(hitData, function(d) {return d.seasonal[0].year;});
  				var max = d3.max(hitData, function(d) {return d.seasonal[d.seasonal.length-1].year;});	
  				lineFx.x(function (d) { return x(d.year) })
  			}
  			x.domain([min,max]);

  			var field = hitDiv.select('#clicker').node().value;
  			hitDiv.select('.xaxis').transition().duration(500).call(xAxis.scale(x));

        var set = hitDiv.select('input[name="optradio2"]').node().value;

  			lineChange(field,set);
  		}
  		timeChange('time');

      function buttonClick(player){
        hitDiv.selectAll('g.player').style('opacity',0.1);
        hitDiv.selectAll('g.player.'+player).style('opacity',1);
      }
      function chartReset(){
        hitDiv.selectAll('.playerBtn').attr('class','playerBtn');
        hitDiv.selectAll('g.player').style('opacity',1);
      }
  			
  		hitDiv.select('#clicker').on('change', function(){
  			var field = d3.select(this).node().value;
        var set = hitDiv.select('input[name="optradio2"]:checked').node().value;
  			lineChange(field,set);
  		});

  		hitDiv.selectAll('input[name="optradio1"]').on('change', function () {
        	var time = d3.select(this).node().value;
        	timeChange(time);
    	});

      hitDiv.selectAll('input[name="optradio2"]').on('change', function () {
          var field = hitDiv.select('#clicker').node().value;
          var set = d3.select(this).node().value;
          lineChange(field,set);
      });

      hitDiv.selectAll('.playerBtn').on('click', function(){
        var player = d3.select(this).attr('player');
        hitDiv.selectAll('.playerBtn').attr('class','playerBtn')
        d3.select(this).attr('class','playerBtn clicked')
        buttonClick(player)
      });

      hitDiv.select('.reset').on('click', function(){
        chartReset();
      });

  	}

    function makePitchers(){
      //bind data to player
      pitchers.forEach(function(guy,i){
        pitchData[i].player = guy;
        var name = guy.split('_').join(" ");
        pitchData[i].display = name;
        pitchDiv.select('.playerList').append('div')
          .attr('class','playerBtn').text(name).attr('player',guy);

        var cumulative = pitchData[i].cumulative;
        var hits=0,wins=0,losses=0,K=0,HR=0,ER=0,BB=0;
        for (var b=0;b<cumulative.length;b++){
          var thisData = cumulative[b];
          hits += thisData.hits;
          wins += thisData.wins;
          losses += thisData.losses;
          K += thisData.K;
          HR += thisData.HR;
          ER += thisData.ER;
          BB += thisData.BB;
          thisData.hits = hits;
          thisData.wins = wins;
          thisData.losses = losses;
          thisData.K = K;
          thisData.HR = HR;
          thisData.ER = ER;
          thisData.BB = BB;
        }
      });

      pitchDiv.select('.playerList').append('span').text('Reset').attr('class','reset');

      var x = d3.scale.linear().range([margins.left,width-margins.right]);
      var y = d3.scale.linear().range([(height-margins.bottom),margins.top]);

      var lines = pitchSvg.selectAll('.player').data(pitchData).append('path')
        .style('fill','none').style('stroke-width',3).style('stroke-opacity',0.5)
        .style('stroke','green');

      var xAxis = d3.svg.axis().orient('bottom').tickFormat(d3.format('d'));
      pitchSvg.append('svg:g')
        .attr('transform','translate('+0+','+(height-margins.bottom)+')')
        .attr('class','xaxis')

      var yAxis = d3.svg.axis().orient('left');
      pitchSvg.append('svg:g')
        .attr('transform','translate('+margins.left+','+0+')')
        .attr('class','yaxis')

      var lineFx = d3.svg.line()
          .interpolate('step-after');

      function lineChange(field,set){
        var fieldMax = d3.max(pitchData, function(d) {
          return d3.max(d[set], function(e){
            return e[field];
          });
        });
        y.domain([0,fieldMax]);
        lineFx.defined(function(d) { return d[field] >= 0; }).y(function (d) { return y(d[field]) });
        lines.transition().duration(500).attr('d', function(d){return lineFx(d[set])});
        pitchDiv.select('.yaxis').transition().duration(500).call(yAxis.scale(y));
      }

      function timeChange(time){
        if (time == 'career'){
          var min = 1;
          var max = d3.max(pitchData, function(d){return d.seasonal.length});
          lineFx.x(function(d,i){return x(i+1)});
        }else{
          var min = d3.min(pitchData, function(d) {return d.seasonal[0].year;});
          var max = d3.max(pitchData, function(d) {return d.seasonal[d.seasonal.length-1].year;});  
          lineFx.x(function (d) { return x(d.year) })
        }
        x.domain([min,max]);

        var field = pitchDiv.select('#clicker').node().value;
        pitchDiv.select('.xaxis').transition().duration(500).call(xAxis.scale(x));

        var set = pitchDiv.select('input[name="optradio2"]').node().value;

        lineChange(field,set);
      }
      timeChange('time');

      function buttonClick(player){
        pitchDiv.selectAll('g.player').style('opacity',0.1);
        pitchDiv.selectAll('g.player.'+player).style('opacity',1);
      }
      function chartReset(){
        pitchDiv.selectAll('.playerBtn').attr('class','playerBtn');
        pitchDiv.selectAll('g.player').style('opacity',1);
      }
        
      pitchDiv.select('#clicker').on('change', function(){
        var field = d3.select(this).node().value;
        var set = pitchDiv.select('input[name="optradio2"]:checked').node().value;
        lineChange(field,set);
      });

      pitchDiv.selectAll('input[name="optradio1"]').on('change', function () {
          var time = d3.select(this).node().value;
          timeChange(time);
      });

      pitchDiv.selectAll('input[name="optradio2"]').on('change', function () {
          var field = pitchDiv.select('#clicker').node().value;
          var set = d3.select(this).node().value;
          lineChange(field,set);
      });

      pitchDiv.selectAll('.playerBtn').on('click', function(){
        var player = d3.select(this).attr('player');
        pitchDiv.selectAll('.playerBtn').attr('class','playerBtn')
        d3.select(this).attr('class','playerBtn clicked')
        buttonClick(player)
      });

      pitchDiv.select('.reset').on('click', function(){
        chartReset();
      });

    }

  });
  	
  </script>
  </body>

</html>

