
<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
     <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>MLB Data Viz challenge</title>
    <link href='https://cdnjs.cloudflare.com/ajax/libs/skeleton/2.0.4/skeleton.min.css' rel='stylesheet' type='text/css'/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js" charset="utf-8"></script>

    <style>
      .playerList{
        width:100%;
        height:180px;
      }
      .container{
        margin-bottom:5rem;
      }
      .playerBtn{
        display:inline-block;
        float:left;
        width:100px;
        height:100px;
        margin:5px;
        background-size:cover;
        background-position:top;
        background-color:rgba(200,0,200,0.1);
        cursor:pointer;
      }
      .clicked{
        background-color:rgba(255,255,0,0.1);
        border-radius:100%;
      }
      .reset{
        display:block;
        clear:both;
        width:auto;
        cursor:pointer;
        float:right;
      }
      .container select{
        display:inline-block;
        width:20%;
        float:left;
        clear:both;
      }
      .container label{
        display:inline-block;
        width:20%;
        float:left;
        margin:0 auto;
      }
    </style>

  </head>

  <body>
  <div id='hitting' class='container'>
    <div class='row'>
      <div class='twelve columns'>
        <h2>Best Bats</h2>
      </div>
    </div>
    <div class='row'>
    <div class='twelve columns'>
    	<select id='clicker'>
    		<option value='HR'>Homers</option>
    		<option value='hits'>Hits</option>
    		<option value='RBI'>Ribbys</option>
    		<option value='BA'>Batting Average</option>
    		<option value='slug'>Slugging</option>
    		<option value='runs'>Runs</option>
    	</select>
      
      <label><input type="radio" value="time" name="optradio1" checked>Over Time</label>
      <label><input type="radio" value="career" name="optradio1">Over Career</label>
      
      <label><input type="radio" value="seasonal" name="optradio2" checked>Single-Season</label>
      <label><input type="radio" value="cumulative" name="optradio2">Cumulatively</label>
    </div>
    </div>
    <div class='row'>
      <div class='four columns'>
        <div class='playerList hitters'></div>
      </div>
      <div class='svgContain eight columns'></div>
    </div>
  </div>

  <div id='pitching' class='container'>
    <div class='row'>
      <div class='twelve columns'>
        <h2>Best Arms</h2>
      </div>
    </div>
    <div class='row'>
    <div class='twelve columns'>
      <select id='clicker'>
        <option value='wins'>Wins</option>
        <option value='losses'>Losses</option>
        <option value='K'>Strikeouts</option>
        <option value='ERA'>ERA</option>
        <option value='ER'>Earned Runs</option>
        <option value='WHIP'>WHIP</option>
      </select>
      
      <label><input type="radio" value="time" name="optradio3" checked>Over Time</label>
      <label><input type="radio" value="career" name="optradio3">Over Career</label>
      
      <label><input type="radio" value="seasonal" name="optradio4" checked>Single-Season</label>
      <label><input type="radio" value="cumulative" name="optradio4">Cumulatively</label>
    </div>
    </div>
    <div class='row'>
      <div class='four columns'>
        <div class='playerList pitchers'></div>
      </div>
      <div class='svgContain eight columns'></div>
    </div>
  </div>

  <script>
    //could refactor so that there's one graph, generated by input of what you want to see (i.e. 'pitchers' or 'hitters')
    $(document).on('ready',function(){
    var width = parseFloat(d3.select('.eight.columns').style('width'));
  	var height = 500, margins = {left:50,right:50,top:20,bottom:20};
    var hitDiv = d3.select('#hitting');
    var pitchDiv = d3.select('#pitching');
  	var hitSvg = hitDiv.select('.svgContain').append('svg').attr('height',height).attr('width',width);
    var pitchSvg = pitchDiv.select('.svgContain').append('svg').attr('height',height).attr('width',width);

  	var hitData = [];
    var pitchData = [];

    for (var i=0;i<10;i++){
      d3.csv('hitters/player'+i+'.csv')
        .row(function(d) { 
          return {
            player:d.Player,year:+d.Year,hits:+d.H,doubles:+d['2B'],triples:+d['3B'],RBI:+d.RBI,HR:+d.HR,runs:+d.R,
            TB:+d.TB,AB:+d.AB,slug:+d.SLG,BA:+d.BA,BB:+d.BB,IBB:+d.IBB,SB:+d.SB,CS:+d.CS,K:+d.SO,G:+d.G
          }
        })
        .get(function(error, rows) { 
          var cumulative = JSON.parse(JSON.stringify(rows));
          var playerData = {seasonal:rows,cumulative:cumulative};
          hitData.push(playerData);
          if (hitData.length === 10){
            makeHitters();
          }
        })

      d3.csv('pitchers/player'+i+'.csv')
        .row(function(d) { 
          return {
            player:d.Player,year:+d.Year,wins:+d.W,losses:+d.L,ERA:+d.ERA,hits:+d.H,IP:+d.IP,ER:+d.ER,HR:+d.HR,K:+d.SO,
            WHIP:+d.WHIP,H9:+d.H9,BB:+d.BB,IBB:+d.IBB,HR9:+d.HR9,BB9:+d.BB9,K9:+d.SO9,KpW:+d['SO/W']
          }
        })
        .get(function(error, rows) { 
          var cumulative = JSON.parse(JSON.stringify(rows));
          var playerData = {seasonal:rows,cumulative:cumulative};
          pitchData.push(playerData);
          if (pitchData.length === 10){
            makePitchers();
          }
        })
    }

  	function makeHitters(){
  		//bind data to player
      hitData.forEach(function(data){
        var guy = data.seasonal[0].player;
        data.player = guy;
        var name = guy.split('_').join(' ');
        data.display = name;

        hitDiv.select('.playerList').append('div')
          .attr('class','playerBtn').attr('player',guy)//.text(name)
          .style('background-image', 'url(images/'+guy+'.png)');

        var cumulative = data.cumulative;
        var hits=0,doubles=0,triples=0,RBI=0,HR=0,R=0;
        for (var b=0;b<cumulative.length;b++){
          var thisData = cumulative[b];
          hits += thisData.hits;
          doubles += thisData.doubles;
          triples += thisData.triples;
          RBI += thisData.RBI;
          HR += thisData.HR;
          R += thisData.runs;
          thisData.hits = hits;
          thisData.doubles = doubles;
          thisData.triples = triples;
          thisData.RBI = RBI;
          thisData.HR = HR;
          thisData.runs = R;
        }
      });

      hitDiv.select('.playerList').append('span').text('Reset').attr('class','reset');

    	var x = d3.scale.linear().range([margins.left,width-margins.right]);
  		var y = d3.scale.linear().range([(height-margins.bottom),margins.top]);

      var players = hitSvg.selectAll('.player').data(hitData).enter().append('g').attr('class', function(d){return 'player '+d.player})
      var lines = players.append('path')
  			.style('fill','none').style('stroke-width',3).style('stroke-opacity',0.5).style('stroke','green');
        
  		var xAxis = d3.svg.axis().orient('bottom').tickFormat(d3.format('d'));
  		hitSvg.append('svg:g')
  			.attr('transform','translate('+0+','+(height-margins.bottom)+')')
  			.attr('class','xaxis')

  		var yAxis = d3.svg.axis().orient('left');
  		hitSvg.append('svg:g')
  			.attr('transform','translate('+margins.left+','+0+')')
  			.attr('class','yaxis')

	  	var lineFx = d3.svg.line()
	        .interpolate('step-after');

  		function lineChange(field,set){
	  		var fieldMax = d3.max(hitData, function(d) {
	  			return d3.max(d[set], function(e){
	  				return e[field];
	  			});
	  		});
	  		y.domain([0,fieldMax]);
	      lineFx.defined(function(d) { return d[field] >= 0; }).y(function (d) { return y(d[field]) });
	  		lines.transition().duration(500).attr('d', function(d){return lineFx(d[set])});
	  		hitDiv.select('.yaxis').transition().duration(500).call(yAxis.scale(y));
  		}

  		function timeChange(time){
  			if (time == 'career'){
  				var min = 1;
  				var max = d3.max(hitData, function(d){return d.seasonal.length});
  				lineFx.x(function(d,i){return x(i+1)});
  			}else{
  			  var min = d3.min(hitData, function(d) {return d.seasonal[0].year;});
  				var max = d3.max(hitData, function(d) {return d.seasonal[d.seasonal.length-1].year;});	
  				lineFx.x(function (d) { return x(d.year) })
  			}
  			x.domain([min,max]);

  			var field = hitDiv.select('#clicker').node().value;
  			hitDiv.select('.xaxis').transition().duration(500).call(xAxis.scale(x));

        var set = hitDiv.select('input[name="optradio2"]:checked').node().value;

  			lineChange(field,set);
  		}
  		timeChange('time');

      function buttonClick(player){
        hitDiv.selectAll('g.player').style('opacity',0.1);
        hitDiv.selectAll('g.player.'+player).style('opacity',1);
      }
      function chartReset(){
        hitDiv.selectAll('.playerBtn').attr('class','playerBtn');
        hitDiv.selectAll('g.player').style('opacity',1);
      }
  			
  		hitDiv.select('#clicker').on('change', function(){
  			var field = d3.select(this).node().value;
        var set = hitDiv.select('input[name="optradio2"]:checked').node().value;
  			lineChange(field,set);
  		});

  		hitDiv.selectAll('input[name="optradio1"]').on('change', function () {
        	var time = d3.select(this).node().value;
        	timeChange(time);
    	});

      hitDiv.selectAll('input[name="optradio2"]').on('change', function () {
          var field = hitDiv.select('#clicker').node().value;
          var set = d3.select(this).node().value;
          lineChange(field,set);
      });

      hitDiv.selectAll('.playerBtn').on('click', function(){
        var player = d3.select(this).attr('player');
        hitDiv.selectAll('.playerBtn').attr('class','playerBtn')
        d3.select(this).attr('class','playerBtn clicked')
        buttonClick(player)
      });

      hitDiv.select('.reset').on('click', function(){
        chartReset();
      });

  	}

    function makePitchers(){
      //bind data to player
      pitchData.forEach(function(data){
        var guy = data.seasonal[0].player;
        data.player = guy;
        var name = guy.split('_').join(' ');
        data.display = name;

        pitchDiv.select('.playerList').append('div')
          .attr('class','playerBtn').attr('player',guy)//.text(name)
          .style('background-image', 'url(images/'+guy+'.png)');

        var cumulative = data.cumulative;
        var hits=0,wins=0,losses=0,K=0,HR=0,ER=0,BB=0;
        for (var b=0;b<cumulative.length;b++){
          var thisData = cumulative[b];
          hits += thisData.hits;
          wins += thisData.wins;
          losses += thisData.losses;
          K += thisData.K;
          HR += thisData.HR;
          ER += thisData.ER;
          BB += thisData.BB;
          thisData.hits = hits;
          thisData.wins = wins;
          thisData.losses = losses;
          thisData.K = K;
          thisData.HR = HR;
          thisData.ER = ER;
          thisData.BB = BB;
        }
      });

      pitchDiv.select('.playerList').append('span').text('Reset').attr('class','reset');

      var x = d3.scale.linear().range([margins.left,width-margins.right]);
      var y = d3.scale.linear().range([(height-margins.bottom),margins.top]);

      var players = pitchSvg.selectAll('.player').data(pitchData).enter()
          .append('g').attr('class', function(d){return 'player '+d.player})
      var lines = players.append('path')
        .style('fill','none').style('stroke-width',3).style('stroke-opacity',0.5).style('stroke','green');

      var xAxis = d3.svg.axis().orient('bottom').tickFormat(d3.format('d'));
      pitchSvg.append('svg:g')
        .attr('transform','translate('+0+','+(height-margins.bottom)+')')
        .attr('class','xaxis')

      var yAxis = d3.svg.axis().orient('left');
      pitchSvg.append('svg:g')
        .attr('transform','translate('+margins.left+','+0+')')
        .attr('class','yaxis')

      var lineFx = d3.svg.line()
          .interpolate('step-after');

      function lineChange(field,set){
        var fieldMax = d3.max(pitchData, function(d) {
          return d3.max(d[set], function(e){
            return e[field];
          });
        });
        y.domain([0,fieldMax]);
        lineFx.defined(function(d) { return d[field] >= 0; }).y(function (d) { return y(d[field]) });
        lines.transition().duration(500).attr('d', function(d){return lineFx(d[set])});
        pitchDiv.select('.yaxis').transition().duration(500).call(yAxis.scale(y));
      }

      function timeChange(time){
        if (time == 'career'){
          var min = 1;
          var max = d3.max(pitchData, function(d){return d.seasonal.length});
          lineFx.x(function(d,i){return x(i+1)});
        }else{
          var min = d3.min(pitchData, function(d) {return d.seasonal[0].year;});
          var max = d3.max(pitchData, function(d) {return d.seasonal[d.seasonal.length-1].year;});  
          lineFx.x(function (d) { return x(d.year) })
        }
        x.domain([min,max]);

        var field = pitchDiv.select('#clicker').node().value;
        pitchDiv.select('.xaxis').transition().duration(500).call(xAxis.scale(x));

        var set = pitchDiv.select('input[name="optradio4"]:checked').node().value;

        lineChange(field,set);
      }
      timeChange('time');

      function buttonClick(player){
        pitchDiv.selectAll('g.player').style('opacity',0.1);
        pitchDiv.selectAll('g.player.'+player).style('opacity',1);
      }
      function chartReset(){
        pitchDiv.selectAll('.playerBtn').attr('class','playerBtn');
        pitchDiv.selectAll('g.player').style('opacity',1);
      }
        
      pitchDiv.select('#clicker').on('change', function(){
        var field = d3.select(this).node().value;
        var set = pitchDiv.select('input[name="optradio4"]:checked').node().value;
        lineChange(field,set);
      });

      pitchDiv.selectAll('input[name="optradio3"]').on('change', function () {
          var time = d3.select(this).node().value;
          timeChange(time);
      });

      pitchDiv.selectAll('input[name="optradio4"]').on('change', function () {
          var field = pitchDiv.select('#clicker').node().value;
          var set = d3.select(this).node().value;
          lineChange(field,set);
      });

      pitchDiv.selectAll('.playerBtn').on('click', function(){
        var player = d3.select(this).attr('player');
        pitchDiv.selectAll('.playerBtn').attr('class','playerBtn')
        d3.select(this).attr('class','playerBtn clicked')
        buttonClick(player)
      });

      pitchDiv.select('.reset').on('click', function(){
        chartReset();
      });

    }

  });

//photo-credits
/*
Bonds - http://cbsnews1.cbsistatic.com/hub/i/2011/03/29/0cf46bd0-a643-11e2-a3f0-029118418759/barry_bonds_3109552.jpg
Pujols - http://www.robertbeckphotography.com/data/photos/2004_1pujols.jpg
Ruth - http://theroaring20s-project.weebly.com/uploads/4/3/0/6/43062779/767282_orig.jpg
Wagner - https://thenypost.files.wordpress.com/2013/08/d046337114041427-525x415.jpg?w=322&h=215
DiMaggio - http://www.joedimaggio.com/new/wp-content/uploads/6.jpg
Gehrig - https://thenypost.files.wordpress.com/2014/04/big_boppers_baseball.jpg
Mantle - http://www.notablebiographies.com/images/uewb_07_img0457.jpg
Cobb - http://www.sikids.com/sites/default/files/multimedia/photo_gallery/1005/mlb.unbreakable.baseball.records/images/ty-cobb.jpg
Mays - http://sportsnaut.com/wp-content/uploads/2014/07/0168.jpg
Williams - http://nextweekinsports.com/wp-content/uploads/2014/07/ted-williams.jpg
*/
/*
Young - http://www.biografiasyvidas.com/biografia/y/fotos/young_cy.jpg
Grove - http://www.sikids.com/sites/default/files/multimedia/photo_gallery/1005/famous.lefties.in.sports/images/lefty-grove.jpg
Plank - http://bioproj.sabr.org/bp_ftp/images/PlankEddie.jpg
Alexander - https://upload.wikimedia.org/wikipedia/commons/d/d7/Grover_Cleveland_Alexander.jpg
Clemens - http://static4.businessinsider.com/image/4f91b2b2ecad04093e000035/50-year-old-roger-clemens-is-returning-to-professional-baseball.jpg
Seaver - http://a.espncdn.com/media/pg2/2001/0801/photo/a_seaver_i.jpg
Gibson - http://a.espncdn.com/photo/2013/1021/WS13_gibson_1967.jpg
Mathewson - http://www.sikids.com/sites/default/files/multimedia/photo_gallery/1010/mlb.best.postseason.pitching.debuts/images/christy-mathewson.jpg
Drysdale - http://1960sbaseball.com/blog/wp-content/uploads/2014/12/don_drysdale_58.jpg
Johnson - http://bioproj.sabr.org/bp_ftp/images2/JohnsonWalter.jpg
*/
  	
  </script>
  </body>

</html>

